package com.sweet.modular.stock.service.impl;import com.sweet.core.shiro.ShiroKit;import com.sweet.core.util.StringUtil;import com.sweet.modular.cashier.model.ProductForm;import com.sweet.modular.inventory.entity.Inventory;import com.sweet.modular.inventory.service.InventoryService;import com.sweet.modular.stock.entity.Stock;import com.sweet.modular.stock.mapper.StockMapper;import com.sweet.modular.stock.service.StockService;import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;import com.sweet.modular.stockDetail.entity.StockDetail;import com.sweet.modular.stockDetail.service.StockDetailService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import com.baomidou.mybatisplus.core.metadata.IPage;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.sweet.core.model.system.LayuiPageFactory;import com.sweet.core.model.system.LayuiPageInfo;import java.util.List;/** * <p> * 入库单 服务实现类 * </p> * * @author admin * @since 2020-06-18 */@Servicepublic class StockServiceImpl extends ServiceImpl<StockMapper, Stock> implements StockService {    @Autowired    InventoryService inventoryService;    @Autowired    StockDetailService stockDetailService;    @Override    public LayuiPageInfo findPageBySpec(Stock stock) {        Page pageContext = LayuiPageFactory.defaultPage();        IPage page = this.baseMapper.customPageList(pageContext, stock);        return LayuiPageFactory.createPageInfo(page);    }    @Override    public Stock addStock(Stock stock) {        String stockNo = "SHEYI"+StringUtil.getNumberForPK();        stock.setStockStatus(CHECK_PENDING);        stock.setStockType(IN_STOCK);        stock.setStockNo(stockNo);        save(stock);        return stock;    }    @Override    public void consumptionStock( List<ProductForm> productForms) {        String deptId = ShiroKit.getUser().getDeptId();        String deptName = ShiroKit.getUser().getDeptName();        Stock stock = new Stock();        String stockNo = "SHEYI"+ StringUtil.getNumberForPK();        stock.setStockStatus(2);        stock.setStockType(2);        stock.setStockNo(stockNo);        stock.setDeptName(deptName);        stock.setDeptId(deptId);        save(stock);        productForms.stream().forEach(productForm -> {            StockDetail stockDetail = new StockDetail();            stockDetail.setProductName(productForm.getName());            stockDetail.setStockId(stock.getId());            stockDetail.setProductId(productForm.getId());            stockDetail.setCount(1L);            stockDetailService.save(stockDetail);            Inventory inventory = inventoryService.getInventoryByDeptId(deptId,productForm.getId());            inventoryService.subInventory(inventory,1L);        });    }}