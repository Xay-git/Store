<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.sweet.modular.sell.mapper.SellMapper">    <!-- 通用查询映射结果 -->    <resultMap id="BaseResultMap" type="com.sweet.modular.sell.entity.Sell">        <id column="ID" property="id" />        <result column="MEMBER_ID" property="memberId" />        <result column="MEMBER_NAME" property="memberName" />        <result column="SELL_AMOUNT" property="sellAmount" />        <result column="REAL_AMOUNT" property="realAmount" />        <result column="SELL_TYPE" property="sellType" />        <result column="DEPT_ID" property="deptId" />        <result column="CREATE_ID" property="createId" />        <result column="CREATE_NAME" property="createName" />        <result column="CREATE_TIME" property="createTime" />        <result column="STATUS" property="status" />        <result column="REMARK" property="remark" />        <result column="MODIFY_NAME" property="modifyName" />        <result column="MODIFY_ID" property="modifyId" />        <result column="MODIFY_TIME" property="modifyTime" />    </resultMap>    <!-- 通用查询结果列 -->    <sql id="Base_Column_List">        ID, MEMBER_ID, MEMBER_NAME , SELL_AMOUNT, REAL_AMOUNT, SELL_TYPE, DEPT_ID, CREATE_ID, CREATE_NAME, CREATE_TIME,STATUS,REMARK,MODIFY_NAME,MODIFY_ID,MODIFY_TIME    </sql>    <select id="customPageList" resultType="com.sweet.modular.sell.entity.Sell"            parameterType="com.sweet.modular.sell.entity.Sell">        select        a.*,b.PHONE_NUMBER        from business_sell a left join business_member b on a.member_id = b.id where 1 = 1        <if test="param.memberId != null and param.memberId != ''">            and a.MEMBER_ID like concat('%',#{param.memberId},'%')        </if>       <if test="param.memberName != null and param.memberName != ''">        and (a.MEMBER_NAME like concat('%',#{param.memberName},'%')        or b.PHONE_NUMBER like concat('%',#{param.memberName},'%'))       </if>       <if test="param.sellType != null and param.sellType != ''">        and a.SELL_TYPE like concat('%',#{param.sellType},'%')       </if>       <if test="param.deptId != null and param.deptId != ''">           and a.DEPT_ID = #{param.deptId}       </if>        <choose>        <when test="beginTime!= null and beginTime != ''">            and a.create_time between  #{beginTime} and #{endTime}        </when>        </choose>        <if test="param.status != null and param.status != ''">            and a.STATUS like concat('%',#{param.status},'%')        </if>       order by a.create_time desc    </select>    <select id="getSellAmountByDate" resultType="map">            select date_format(create_time,'%Y-%m-%d') as `day`,IFNULL(sum(real_amount),0.00) money from business_sell            where create_time >= date(now()) - interval #{days} day and `status` = 1            <if test="deptId != null and deptId != ''">                and DEPT_ID = #{deptId}            </if>             group by day(create_time)    </select>    <select id="getSellAmountByMonth" resultType="com.sweet.modular.sell.model.SellFull">        SELECT * FROM        (select IFNULL(sum(real_amount),0.00) realAmount,count(1) as count from business_sell where DATE_FORMAT(  create_time, '%Y%m' ) = DATE_FORMAT( CURDATE( ) , '%Y%m' ) and `status` = 1            <if test="deptId != null and deptId != ''">                and DEPT_ID = #{deptId}            </if>        ) t1,        (select IFNULL(sum(AMOUNT),0.00) money from business_sellpay a LEFT JOIN business_sell b on a.SELL_ID = b.id where b.`STATUS` = 1 and DATE_FORMAT(  b.create_time, '%Y%m' ) = DATE_FORMAT( CURDATE( ) , '%Y%m' ) and a.PAY_TYPE !=0            <if test="deptId != null and deptId != ''">                and b.DEPT_ID = #{deptId}            </if>        ) t2    </select>    <select id="getSellAmountByYear" resultType="com.sweet.modular.sell.model.SellFull">       SELECT * FROM        (select IFNULL(sum(real_amount),0.00) realAmount,count(1) as count from business_sell where YEAR(create_time)=YEAR(NOW()) and `status` = 1            <if test="deptId != null and deptId != ''">                and DEPT_ID = #{deptId}            </if>        ) t1,        (select IFNULL(sum(AMOUNT),0.00) money from business_sellpay a LEFT JOIN business_sell b on a.SELL_ID = b.id where b.`STATUS` = 1 and YEAR(b.create_time)=YEAR(NOW()) and a.PAY_TYPE !=0            <if test="deptId != null and deptId != ''">                and b.DEPT_ID = #{deptId}            </if>        ) t2    </select>    <select id="getSellSort" resultType="com.sweet.modular.sell.model.SellSort">        select c.`name`,sum(a.REAL_AMOUNT) amount,count(1) as count,c.PRODUCT_TYPE as 'type' from business_selldetail a left join business_sell b on a.SELL_ID = b.ID LEFT JOIN business_product c on a.PRODUCT_ID = c.ID where a.PRODUCT_ID is not null  and  a.create_time >= date(now()) - interval 7 day        <if test="deptId != null and deptId != ''">           and b.DEPT_ID = #{deptId}        </if>        GROUP BY a.PRODUCT_ID ORDER BY count desc    </select>    <select id="getPayTypePercent" resultType="map">        SELECT t1.PAY_NAME name,ROUND(t1.amount/t2.totalAmount*100,1) value,t1.amount amount from        (select IFNULL(sum(AMOUNT),0.00) amount,a.PAY_TYPE,a.PAY_NAME from business_sellpay a LEFT JOIN business_sell b on a.SELL_ID = b.id where b.`STATUS` = 1 and  a.create_time >= date(now()) - interval 7 day GROUP BY PAY_TYPE        <if test="deptId != null and deptId != ''">            and b.DEPT_ID = #{deptId}        </if>           ) t1,        (select IFNULL(sum(AMOUNT),0.00) totalAmount from business_sellpay a LEFT JOIN business_sell b on a.SELL_ID = b.id where b.`STATUS` = 1 and a.create_time >= date(now()) - interval 7 day        <if test="deptId != null and deptId != ''">            and b.DEPT_ID = #{deptId}        </if>        ) t2    </select>    <select id="findSelltypeByid" resultType="map">        SELECT * FROM business_selldetail sd LEFT JOIN business_sell s ON s.id = sd.sell_id        WHERE sd.CARD_ID = #{id} AND s.STATUS = 1        <if test="type != null and type != '' ">            AND  sd.SELL_TYPE = #{type}        </if>        <if test="beginTime != null and beginTime != '' and endTime != null and endTime != ''">            AND sd.CREATE_TIME BETWEEN #{beginTime} AND #{endTime}        </if>        ORDER BY sd.id DESC    </select></mapper>