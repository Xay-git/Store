<style></style><%layout("/common/_container.html"){%><div class="layui-fluid" id="app">    <div class="layui-row layui-col-space15">        <div class="layui-col-sm12 layui-col-md12 layui-col-lg12">            <div class="layui-card">                <div class="layui-card-body">                    <div class="layui-form toolbar">                        <div class="layui-form-item">                            门店&nbsp;&nbsp;&nbsp;                            <div class="layui-inline">                                <el-select  v-model="deptId" >                                    <el-option                                            v-for="item in deptList"                                            :key="item.deptId"                                            :label="item.deptName"                                            :value="item.deptId"                                    >                                    </el-option>                                </el-select>                            </div>                            <div class="layui-inline">                                <div class="block">                                    <span class="demonstration">日期&nbsp;&nbsp;&nbsp;</span>                                    <el-date-picker                                            v-model="value2"                                            type="datetimerange"                                            :picker-options="pickerOptions"                                            range-separator="至"                                            start-placeholder="开始日期"                                            end-placeholder="结束日期"                                            align="right">                                    </el-date-picker>                                </div>                            </div>                            <div class="layui-inline">                                <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                                <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            </div>                        </div>                    </div>                    <table class="layui-table" id="userTable" lay-filter="userTable"></table>                </div>            </div>        </div>    </div></div><script>    var  initColumn =  [[        {field: 'userId', hide: true, title: 'USERID'},        {title: '#', width: 50, collapse: true,children:[                {                    title: '销售详情',                    data: function(row){                    //row 为当前行数据                     return row.sellList;                    }                    ,height: 200                    ,cols: [[                        {field: 'sellType', title: '销售类型',templet(d){                            console.log(JSON.stringify(d));                                if(d.sellType==1){                                    return "开卡";                                }                                if(d.sellType==2){                                    return "续卡";                                }                                if(d.sellType==3){                                    return "卖品/项目";                                }                            }},                        {field: 'name', title: '项目',},                        {field: 'amount', title: '销售金额',},                        {field: 'pushMoney', title: '业绩'},                        {field: 'createTime', title: '销售日期'},                    ]]                }]},        {field: 'userName',title: '员工编号'},        {field: 'realName',title: '员工姓名'},        {title: '销售单数',templet(d){            return d.sellList.length;            }},        {title: '提成金额',templet(d){                var totalMoney = 0;                for(let item of d.sellList){                    if(item.pushMoney){                        totalMoney = app.accAdd(totalMoney,item.pushMoney);                    }                }                console.log(totalMoney)                return totalMoney;            }},    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            deptList:[],            deptId:'',            condition:'',            pickerOptions: {                shortcuts: [                    {                        text: '今天',                        onClick(picker) {                            const end = new Date();                            const start = new Date(new Date().toLocaleDateString());                            picker.$emit('pick', [start, end]);                        }                    },                    {                        text: '昨天',                        onClick(picker) {                            const end = new Date(new Date().toLocaleDateString());                            const start = new Date(new Date().toLocaleDateString());                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 1);                            picker.$emit('pick', [start, end]);                        }                    }                    ,{                        text: '最近一周',                        onClick(picker) {                            const end = new Date();                            const start = new Date(new Date().toLocaleDateString());                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);                            picker.$emit('pick', [start, end]);                        }                    }, {                        text: '最近一个月',                        onClick(picker) {                            const end = new Date();                            const start = new Date(new Date().toLocaleDateString());                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);                            picker.$emit('pick', [start, end]);                        }                    }, {                        text: '最近三个月',                        onClick(picker) {                            const end = new Date();                            const start = new Date(new Date().toLocaleDateString());                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);                            picker.$emit('pick', [start, end]);                        }                    }]            },            value2: '',            beginTime:'',            endTime:'',        },        methods: {            setDefaultDate(){                const end = new Date();                const start = new Date(new Date().toLocaleDateString());                vm.value2= [start, end];            },            tableReload:function (action) {                if(action=='reset'){ vm.condition = '' };                table.reload('userTable', {where: {                        deptId:vm.deptId,                        beginTime:vm.beginTime,                        endTime:vm.endTime,                    },page:{ curr:1 }});            }        },        mounted:async function() {            vm = this;            vm.setDefaultDate();            this.deptList = await api.getDeptList();            this.deptId = this.deptList[0].deptId;            console.log(vm.beginTime);            console.log(vm.endTime);            layui.use(['soulTable'], function () {                var soulTable = layui.soulTable;                table.render({                    elem: '#userTable',                    url: '/admin/sell/getTechnicians',                    page: true,                    height: "700",                    cellMinWidth: 100,                    cols: initColumn,                    where: {                        deptId: vm.deptId,                        beginTime: vm.beginTime,                        endTime: vm.endTime,                    },                    done:function () {                        soulTable.render(this)                    }                });            })            form.render();        },        updated: function () {            form.render();        },        watch:{            value2:function (newVal) {                vm.beginTime = app.dateFormat(newVal[0],"YYYY-mm-dd HH:MM:SS");                vm.endTime = app.dateFormat(newVal[1],"YYYY-mm-dd HH:MM:SS");            }        }    })</script><% } %>