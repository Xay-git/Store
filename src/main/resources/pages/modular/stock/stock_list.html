<% layout("/common/_container.html"){ %><div class="layui-fluid" id="app"><div class="layui-row layui-col-space20">    <div class="layui-col-md9">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                    <div class="layui-form-item">                        <div class="layui-inline">                            <input v-model="condition" class="layui-input" type="text" placeholder="名称"/>                        </div>                        <div class="layui-inline">                            <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                            <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            <button v-if="app.getUrlParam('type')==1" type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon" >&#xe654;</i>添加</button>                        </div>                    </div>                </div>                <table class="layui-table" id="stockTable" lay-filter="stockTable"></table>            </div>        </div>    </div>    <div class="layui-col-md3">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                </div>                <table class="layui-table" id="stockDetailTable" lay-filter="stockDetailTable"></table>            </div>        </div>    </div></div></div><script type="text/html" id="tableBar">    {{#    var permissions = top.vm.permissions;    if(d.stockStatus==1){ }}    {{# if(permissions.indexOf('check:stock')>-1){}}    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit" >审核 </a>    {{#  } }}    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">撤销</a>    {{#  } }}</script><script>    var initColumn =  [[        {type: 'radio'},        {field:'id',title:'',hide:true},        {field:'stockNo',title:'出入库编号',width:180},        {field:'deptName',title:'门店名称'},        {field:'createName',title:'创建人'},        {field:'createTime',title:'创建时间',width:180},        {field:'checkName',title:'审核人姓名',hide: app.getUrlParam("type")==2},        {field:'checkTime',title:'审核时间',width:180,hide: app.getUrlParam("type")==2},        {field:'stockStatus',title:'状态',hide: app.getUrlParam("type")==2,templet(d){            if(d.stockStatus==1){                return '<span style="color: #FFB800;">待审核</span>';            }else if(d.stockStatus==2) {                return '<span style="color:#5FB878">已审核</span>';            }else{                return '<span style="color:#FF5722">已撤销</span>'            }            }},        {field:'remark',title:'备注'},        {align: 'center',fixed:'right', toolbar: '#tableBar', title: '操作',width:150}    ]];    var initColumn1 =  [[        {type: 'checkbox'},        {field:'productName',title:'卖品名'},        {field:'count',title:'数量'},    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            condition:'',            type:'',        },        methods: {            btnAdd:function () {                location.href = 'stock_edit';            },            tableReload:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    name:vm.condition,                };                table.reload('stockTable',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                }});            }        },        mounted:async function() {            vm = this;            table.render({                elem: '#stockTable',                url: 'getStockList',                page: true,                height: "full-105",                cellMinWidth: 100,                cols: initColumn,                where:{                    stockType: app.getUrlParam("type")                }            });            table.on('radio(stockTable)', function (obj) {                table.reload('stockDetailTable',{                    where: {                        stockId: obj.data.id                    }});            })            table.render({                elem: '#stockDetailTable',                url: '/admin/stockDetail/getStockDetailList',                page: false,                height: "full-60",                cellMinWidth: 100,                cols: initColumn1,                where:{                    stockId:'11111111111111111'                }            });            table.on('tool(stockTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    app.confirm("确定撤销吗?",function () {                        request.fetch("delStock",{                            id:data.id,                            stockStatus:data.stockStatus,                        }).then(res=>{                            app.success("撤销成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    app.confirm("确定审核?",function () {                        request.post("checkStock",{                            id:data.id,                            stockStatus:data.stockStatus,                        }).then(res=>{                            app.success("操作成功！")                            vm.tableReload();                        })                    })                }            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>