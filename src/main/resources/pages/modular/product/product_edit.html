<% layout("/common/_container.html"){ %><div class="layui-fluid" id="app">    <div class="layui-card" style="max-width: 60%;margin:30px auto;">        <div class="layui-card-body" >            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 35px;">                <legend>{{type==1?'项目':'卖品'}}</legend>            </fieldset>            <form class="layui-form" lay-filter="productForm" style="margin: 35px 0 30px 20%;">                    <input type="hidden" name="id">                    <input type="hidden" name="productType" :value="type">                    <div class="layui-form-item">                        <label class="layui-form-label">{{type==1?'项目':'卖品'}}编号<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <input name="productNo" type="number" :readonly="info.id"   oninput="app.clearNoNum(this)" placeholder="项目编号" class="layui-input" lay-verify="required" />                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">所属分类<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <select name="categoryId" lay-filter="chooseCategory" lay-verify="required">                                <option                                        v-for="item in categoryList"                                        :value="item.id"                                >{{item.name}}                                </option>                            </select>                            <input type="hidden" id="categoryName" name="categoryName">                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">名称<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <input name="name" type="text" placeholder="请输入名称" class="layui-input" lay-verify="required" />                        </div>                    </div>                <div class="layui-form-item" v-if="type==2">                    <label class="layui-form-label">单位<span style="color: red;">*</span> </label>                    <div class="layui-input-inline">                        <select name="unit" lay-filter="unit" lay-verify="required">                            <option></option>                            <option                                    v-for="item in unitList"                                    :value="item.name"                            >{{item.name}}                            </option>                        </select>                    </div>                </div>                    <div class="layui-form-item">                        <label class="layui-form-label">零售价<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <input name="amount" type="text" oninput="app.clearNoNum(this)" placeholder="请输入金额" class="layui-input" lay-verify="required" />                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">会员价<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <input name="memberAmount" type="text" oninput="app.clearNoNum(this)" placeholder="请输入金额" class="layui-input" lay-verify="required" />                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">提成金额<span style="color: red;">*</span> </label>                        <div class="layui-input-inline">                            <input name="pushMoney" type="text" oninput="app.clearNoNum(this)" placeholder="请输入金额" class="layui-input" lay-verify="required" />                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">图片</label>                        <div class="layui-input-inline">                             <button type="button" class="layui-btn layui-btn-sm" id="imagesUpload"><i class="layui-icon"></i>选择图片</button>                             <div class="layui-upload-list">                                 <template v-if="imagesList.length>0">                                     <template v-for="(item,index) in imagesList">                                         <div style="display: inline-block;">                                             <img :src="item.filePath" @click="app.previewImg" width="92px" height="92px" style="margin-right: 10px;"><br/><br/>                                             <button type="button" @click="app.deleteImg(index,imagesList)" style="margin-left: 25px"  class="layui-btn layui-btn-danger layui-btn-xs">删除</button>                                         </div>                                     </template>                                 </template>                                 <input type="hidden" name="images" v-model="app.isNotEmpty(imagesList)?getimagesIds:''">                            </div>                        </div>                    </div>                    <div class="layui-form-item">                        <label class="layui-form-label">备注</label>                        <div class="layui-input-inline">                             <textarea name="remark" placeholder="请输入备注" class="layui-textarea" lay-verify="" ></textarea>                        </div>                    </div>                    <div class="layui-form-item" style="margin:28px 30px;">                        <div class="layui-input-block">                            <button type="button" class="layui-btn" lay-filter="productForm" lay-submit>提交</button>                            <button type="button" class="layui-btn layui-btn-primary" @click="back">返回</button>                        </div>                    </div>            </form>        </div>    </div></div><script>    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            type:'',            info:{},            imagesList:[],            categoryList:[],            unitList:''        },        computed:{            getimagesIds:function(){                var fileIds = '';                var list = vm.imagesList;                if(app.isNotEmpty(list)){                    for(let img of list){                        fileIds += img.fileId+",";                    }                    fileIds = fileIds.slice(0,fileIds.length-1);                }                return fileIds;            }        },        methods: {            getDetail:async function(id){                vm.info = await request.fetch("getProductDetail",{id:id});                form.val('productForm', vm.info);                if(app.isNotEmpty(vm.info.images)){                    vm.imagesList = await api.getFileList(vm.info.images);                }            },            back:function(){                location.href = 'product_list?type='+app.getUrlParam("type");            },            async getCategoryByType(){                vm.categoryList = await request.fetch("/admin/category/getCategoryByType",{categoryType:vm.type});                $('#categoryName').val(vm.categoryList[0].name);            },        },        mounted:async function() {            vm = this;            vm.type = app.getUrlParam("type");            await vm.getCategoryByType();            vm.unitList =  await api.getDictDetail("ff04d0a19011c2625522797f6667ea93");            var id = app.getUrlParam('id');            app.isNotEmpty(id) && await vm.getDetail(id);            upload.render({                elem: '#imagesUpload',                url: '/admin/common/upload',                accept: 'images',                data: {                    fileSavePath:""                },                done: function(res, index, upload){ //上传后的回调                    app.success("上传成功");                    var fileId = res.data.fileId;                    var filePath = res.data.filePath;                    vm.imagesList.push(res.data);                }            });            form.on('select(chooseCategory)', function(data){                var id = data.value;                var data= vm.categoryList.filter(function(item){                    return item.id == id;                })                $('#categoryName').val(data[0].name);            });            form.on('submit(productForm)', function (data) {                request.post("editProduct",data.field).then(res=>{                    app.success("操作成功！");                    location.href = 'product_list?type='+app.getUrlParam("type");                })                return false;            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %><style>    .layui-input-inline{        min-width:350px !important;    }    .layui-form-select dl{        z-index:9999;    }</style>