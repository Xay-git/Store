<% layout("/common/_container.html"){ %><link rel="stylesheet" href="/modular/css/cashier.css" media="all"><div  id="app">    <div class="top_tab" >        <el-menu :default-active="activeIndex" class="el-menu-demo" mode="horizontal" @select="handleSelect" active-text-color="#d81f3e">            <el-menu-item index="1">普通会员</el-menu-item>            <el-menu-item index="2">已删除会员</el-menu-item>        </el-menu>    </div>    <div v-show="activeIndex==1">    <div class="layui-col-md12" style="margin-top: 70px;">        <div class="layui-card">            <div class="layui-card-body">                <div class="layui-form toolbar">                    <div class="layui-form-item">                        <div class="layui-inline">                            <input v-model="condition" class="layui-input" type="text" placeholder="名称"/>                        </div>                        <div class="layui-inline">                            <button type="button" @click="tableReload" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                            <button type="button" @click="tableReload('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            <button type="button" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                        </div>                    </div>                </div>                <table class="layui-table" id="memberTable" lay-filter="memberTable"></table>            </div>        </div>    </div>    </div>    <div v-show="activeIndex==2">        <div class="layui-col-md12" style="margin-top: 70px;">            <div class="layui-card">                <div class="layui-card-body">                    <div class="layui-form toolbar">                        <div class="layui-form-item">                            <div class="layui-inline">                                <input v-model="condition1" class="layui-input" type="text" placeholder="名称"/>                            </div>                            <div class="layui-inline">                                <button type="button" @click="tableReload1" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>                                <button type="button" @click="tableReload1('reset')" class="layui-btn icon-btn" ><i class="layui-icon">&#xe669;</i>重置</button>                            </div>                        </div>                    </div>                    <table class="layui-table" id="memberTable1" lay-filter="memberTable"></table>                </div>            </div>        </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a></script><script>    var initColumn =  [[        {type: 'checkbox'},        {field:'id',title:'ID',hide:true},        {field:'name',title:'姓名',templet(d) {            var html = "<a style=\"color: #009688;cursor: pointer;\" onclick=\"openRight('"+d.id+"')\" > "+d.name+"</a>"            return  html;            }},        {field:'phoneNumber',title:'手机号'},        {field:'balance',title:'余额'},        {field:'sex',title:'性别',templet(res){            if(res.sex==1){                return '男'            }else{                return '女'            }            }},        {field:'birthday',title:'出生年月'},        {field:'remark',title:'备注'},        {field:'createTime',title:'创建时间'},        {align: 'center', toolbar: '#tableBar', title: '操作'}    ]];    var initColumn1 =  [[        {type: 'checkbox'},        {field:'id',title:'ID',hide:true},        {field:'name',title:'姓名',templet(d) {                var html = "<a style=\"color: #009688;cursor: pointer;\" onclick=\"openRight('"+d.id+"')\" > "+d.name+"</a>"                return  html;            }},        {field:'phoneNumber',title:'手机号'},        {field:'balance',title:'余额'},        {field:'sex',title:'性别',templet(res){                if(res.sex==1){                    return '男'                }else{                    return '女'                }            }},        {field:'birthday',title:'出生年月'},        {field:'remark',title:'备注'},        {field:'createTime',title:'创建时间'},    ]];    function openRight(id){        top.layer.open({            type: 2            ,content:'/admin/cashier/member_edit?id='+id            ,anim: -1            ,title: false            ,closeBtn: false            ,offset: 'r'            ,shade: 0.1            ,shadeClose: true            ,skin: 'layui-anim layui-anim-rl layui-layer-adminRight'            ,area:['61%','100%'],            success: function(layero, index){                var iframeWin = layero.find('iframe')[0].contentWindow;            }        })    }    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            condition:'',            condition1:'',            loginUser:'',            activeIndex:'1'        },        methods: {            handleSelect(tab, keyPath) {                vm.activeIndex = tab;                if(vm.activeIndex==1){                    vm.getMemberTable();                }else{                    vm.getDelMemberTable();                }            },            btnAdd:function () {                location.href = 'member_edit';            },            tableReload:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    name:vm.condition,                    phoneNumber:vm.condition,                    deptId:vm.loginUser.deptId,                };                table.reload('memberTable',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                    }});            },            tableReload1:function (action) {                if(action=='reset'){ vm.condition='' };                var queryData = {                    name:vm.condition,                    phoneNumber:vm.condition,                };                table.reload('memberTable1',{                    where: queryData, page: {                        curr: 1 //重新从第 1 页开始                    }});            },            getMemberTable(){                table.render({                    elem: '#memberTable',                    url: 'getMemberList',                    page: true,                    height: "full-150",                    cellMinWidth: 100,                    cols: initColumn,                    where:{                        deptId:vm.loginUser.deptId,                        memberStatus:1                    }                });            },            getDelMemberTable(){                table.render({                    elem: '#memberTable1',                    url: 'getMemberList',                    page: true,                    height: "full-150",                    cellMinWidth: 100,                    cols: initColumn1,                    where:{                        deptId:vm.loginUser.deptId,                        memberStatus:2                    }                });            }        },        mounted:async function() {            vm = this;            vm.loginUser = await api.getLoginUser();            vm.getMemberTable();            table.on('tool(memberTable)', function (obj) {                var event = obj.event;                var data = obj.data;                if (event == 'del') {                    app.confirm("确定删除吗?",function () {                        request.fetch("delMember",{id:data.id}).then(res=>{                            app.success("删除成功！")                            vm.tableReload();                        })                    })                } else if (event == 'edit') {                    location.href = 'member_edit?id='+data.id;                }            });            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>