<% layout("/common/_container.html"){ %><style>    .layui-fluid .quick-link a {        width: 220px;        font-size: 22px;        padding: 24px 0;    }    .flex-justify {        display: -webkit-box;        display: -ms-flexbox;        display: flex;        -webkit-box-align: center;        -ms-flex-align: center;        align-items: center;        -webkit-box-pack: justify;        -ms-flex-pack: justify;        justify-content: space-between;    }</style><link rel="stylesheet" href="/plugin/layuiadmin/style/admin.css" media="all"><link rel="stylesheet" href="/common/css/global.css" media="all"><div class="layui-fluid" id="app">    <div class="layui-row layui-col-space15">        <div class="layui-col-sm6 layui-col-md3">            <div class="layui-card">                <div class="layui-card-header">                    今日总营收                </div>                <div class="layui-card-body layuiadmin-card-list">                    <p class="layuiadmin-big-font" style="color: #d81f3e;">                        {{app.getFloatStr(result.totalMoney)}}                    </p>                    <p>                        昨日 <span class="layuiadmin-big-font">￥{{app.getFloatStr(lastresult.totalMoney)}}</span>                    </p>                </div>            </div>        </div>        <div class="layui-col-sm6 layui-col-md3">            <div class="layui-card">                <div class="layui-card-header">                    今日现金营收                </div>                <div class="layui-card-body layuiadmin-card-list">                    <p class="layuiadmin-big-font" style="color: #d81f3e;">                        {{app.getFloatStr(result.realMoney)}}                    </p>                    <p>                        昨日 <span class="layuiadmin-big-font">￥{{app.getFloatStr(lastresult.realMoney)}}</span>                    </p>                </div>            </div>        </div>        <div class="layui-col-sm6 layui-col-md3">            <div class="layui-card">                <div class="layui-card-header">                    销售单数                </div>                <div class="layui-card-body layuiadmin-card-list">                    <p class="layuiadmin-big-font" style="color: #d81f3e;">{{result.count}}</p>                    <p>                        昨日 <span class="layuiadmin-big-font">{{lastresult.count}}</span>                    </p>                </div>            </div>        </div>        <div class="layui-col-sm6 layui-col-md3">            <div class="layui-card">                <div class="layui-card-header">                    新增会员                </div>                <div class="layui-card-body layuiadmin-card-list">                    <p class="layuiadmin-big-font" style="color: #d81f3e;">{{result.memberCount}}</p>                    <p>                        昨日 <span class="layuiadmin-big-font">{{lastresult.memberCount}}</span>                    </p>                </div>            </div>        </div>        <div class="layui-col-sm6 layui-col-md12" style="padding: 30px;margin-top: 50px;">            <div class="flex-justify quick-link">                <a class="btn shadow btn-red linear c-1" @click="openTap(1)" ><i class="iconfont icon-shouyin" ></i>会员收银</a>                <a class="btn shadow btn-green linear c-2" @click="openTap(2)"  ><i class="iconfont icon-xinzengyuyue"></i>散客收银</a>                <a class="btn shadow btn-orange linear c-3" @click="openTap(3)"  ><i class="iconfont icon-xinzenghuiyuan"></i>新增会员</a>                <a class="btn shadow btn-blue linear c-4" @click="openTap(4)" ><i class="iconfont icon-chakanzhangdan"></i>查看账单</a>            </div>        </div></div></div><script>    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            result:'',            lastresult:'',            loginUser:'',        },        methods: {            openTap (type){                if(type==4){                    top.layui.index.openTab({                        title: '营业数据',                        url: "/admin/sell/sell_list",                        end: function() {                        }                    });                }else{                    top.layui.index.openTab({                        title: '收银台',                        url: "/admin/cashier?activeIndex="+type,                    });                }            },            async getSellList(begintime,endtime){               return await request.fetch('/admin/sell/getSellList',{deptId:vm.loginUser.deptId,beginTime:begintime,endTime:endtime,status:1});            },            getResult(res){                var data = res;                var count = res.length;                var totalMoney = 0 ;                var cardpay = 0 ;                var cashpay = 0;                var unionpay = 0;                var alipay = 0;                var wxpay = 0;                var otherpay = 0;                var discountpay = 0;                var realMoney = 0;                var cardPay = 0;                for(let item of data){                    totalMoney = app.accAdd(item.sellAmount,totalMoney);                    var sellpayList = item.sellpayList;                    for(let pay of sellpayList){                        var payType = pay.payType;                        if(payType==0){                            cardpay = app.accAdd(pay.amount,cardpay);                        }else if(payType==1){                            cashpay = app.accAdd(pay.amount,cashpay);                        }else if(payType==2){                            unionpay = app.accAdd(pay.amount,unionpay);                        }else if(payType==3){                            alipay = app.accAdd(pay.amount,alipay);                        }else if(payType==4){                            wxpay = app.accAdd(pay.amount,wxpay);                        }else if(payType==5){                            otherpay = app.accAdd(pay.amount,otherpay);                        }else if(payType==6){                            discountpay = app.accAdd(pay.amount,discountpay);                        }                    }                }                realMoney = app.Subtr(app.Subtr(totalMoney,cardpay),discountpay);                return {                    count:count,                    totalMoney:totalMoney,                    cardpay:cardpay,                    cashpay:cashpay,                    unionpay:unionpay,                    alipay:alipay,                    wxpay:wxpay,                    otherpay:otherpay,                    discountpay:discountpay,                    realMoney:realMoney                }            }        },        mounted:async function() {            vm = this;            vm.loginUser = await api.getLoginUser();            var todaystart = app.dateFormat(new Date(new Date().toLocaleDateString()),"YYYY-mm-dd HH:MM:SS");            var todayend = app.dateFormat(new Date(),"YYYY-mm-dd HH:MM:SS");            vm.getSellList(todaystart,todayend).then(res=>{                vm.result = vm.getResult(res);                request.fetch("/admin/member/getMemberCountByTime",{beginTime:todaystart,endTime:todayend}).then(res=>{                    Vue.set(vm.result,'memberCount',res);                })            });            var laststart = new Date(new Date().toLocaleDateString());            laststart.setTime(laststart.getTime() - 3600 * 1000 * 24 * 1);            laststart = app.dateFormat(laststart,"YYYY-mm-dd HH:MM:SS");            var lastend = new Date(new Date().toLocaleDateString());            lastend = app.dateFormat(lastend,"YYYY-mm-dd HH:MM:SS");            vm.getSellList(laststart,lastend).then(res=>{                vm.lastresult = vm.getResult(res);                request.fetch("/admin/member/getMemberCountByTime",{beginTime:laststart,endTime:lastend}).then(res=>{                    Vue.set(vm.lastresult,'memberCount',res);                })            });        },        updated: function () {        }    })</script><% } %>